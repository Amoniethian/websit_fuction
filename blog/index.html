<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Personal Blog</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- Top Navigation -->
    <nav class="navbar">
        <div class="logo">Blog</div>
        <div class="nav-actions">
            <button title="Notifications">üîî</button>
            <button title="Search">üîç</button>
            <div class="user-avatar" id="nav-visitor-avatar"></div>
        </div>
    </nav>

    <!-- Main Container -->
    <div class="main-container">
        <!-- Sidebar - Blogger Profile -->
        <aside class="sidebar">
            <div class="profile-card">
                <div class="profile-cover"></div>
                <div class="profile-info">
                    <div class="profile-avatar" id="blogger-avatar"></div>
                    <div class="profile-name">
                        <span id="blogger-display-name"></span>
                        <span class="verified-badge" id="verified-badge" style="display: none;">‚úì</span>
                    </div>
                    <div class="profile-username" id="blogger-username"></div>
                    <div class="profile-bio" id="blogger-bio"></div>
                    <div class="profile-location" id="blogger-location"></div>
                    <div class="profile-stats">
                        <div class="stat-item">
                            <div class="stat-number" id="stat-followers"></div>
                            <div class="stat-label">Followers</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number" id="stat-following"></div>
                            <div class="stat-label">Following</div>
                        </div>
                    </div>
                </div>
                <div class="profile-actions">
                    <button class="btn-message" onclick="openChat()">
                        üí¨ Message
                    </button>
                </div>
            </div>
        </aside>

        <!-- Posts -->
        <main class="posts-container" id="posts-container"></main>
    </div>

    <!-- Chat / DM Window -->
    <div class="chat-overlay" id="chat-overlay">
        <div class="chat-window">
            <div class="chat-header">
                <div class="avatar" id="chat-blogger-avatar"></div>
                <div class="info">
                    <div class="name" id="chat-blogger-name"></div>
                    <div class="status" id="chat-status"></div>
                </div>
                <button class="chat-close" onclick="closeChat()">√ó</button>
            </div>
            <div class="chat-messages" id="chat-messages">
                <div class="typing-indicator" id="typing-indicator">
                    <span>.</span><span>.</span><span>.</span> typing
                </div>
                <div class="no-reply-notice" id="no-reply-notice"></div>
            </div>
            <div class="chat-input-container">
                <input type="text" class="chat-input" id="chat-input" placeholder="Type a message..." onkeypress="handleChatKeypress(event)">
                <button class="chat-send" id="chat-send" onclick="sendMessage()">‚û§</button>
            </div>
        </div>
    </div>

    <script src="config.js"></script>
    <script>
        // ========== Global State ==========
        let replyCount = 0;
        const config = BLOG_CONFIG;

        // ========== Utility Functions ==========
        function formatNumber(num) {
            if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
            if (num >= 1000) return (num / 1000).toFixed(1) + 'K';
            return num.toLocaleString();
        }

        function getInitial(name) {
            return name.charAt(0).toUpperCase();
        }

        function createAvatarElement(src, name, size = 44) {
            const container = document.createElement('div');
            if (src) {
                const img = document.createElement('img');
                img.src = src;
                img.alt = name;
                img.onerror = function() {
                    this.parentElement.innerHTML = `<div class="avatar-placeholder" style="width:${size}px;height:${size}px;">${getInitial(name)}</div>`;
                };
                container.appendChild(img);
            } else {
                container.innerHTML = `<div class="avatar-placeholder" style="width:${size}px;height:${size}px;">${getInitial(name)}</div>`;
            }
            return container.innerHTML;
        }

        // ========== Init Page ==========
        function initPage() {
            const blogger = config.blogger;
            const visitor = config.visitor;

            document.title = `${blogger.displayName}'s Blog`;
            document.getElementById('nav-visitor-avatar').textContent = getInitial(visitor.displayName);

            const bloggerAvatarEl = document.getElementById('blogger-avatar');
            bloggerAvatarEl.innerHTML = createAvatarElement(blogger.avatar, blogger.displayName, 80);

            document.getElementById('blogger-display-name').textContent = blogger.displayName;
            document.getElementById('blogger-username').textContent = '@' + blogger.name;
            document.getElementById('blogger-bio').textContent = blogger.bio;
            document.getElementById('blogger-location').textContent = blogger.location;

            if (blogger.verified) {
                document.getElementById('verified-badge').style.display = 'flex';
            }

            document.getElementById('stat-followers').textContent = formatNumber(blogger.followers);
            document.getElementById('stat-following').textContent = formatNumber(blogger.following);

            document.getElementById('chat-blogger-avatar').innerHTML = createAvatarElement(blogger.avatar, blogger.displayName);
            document.getElementById('chat-blogger-name').textContent = blogger.displayName;
            document.getElementById('chat-status').textContent = config.chat.bloggerStatus;
            if (config.chat.bloggerOnline) {
                document.getElementById('chat-status').classList.add('online');
            }

            renderPosts();
            initChatHistory();
        }

        // ========== Render Posts ==========
        function renderPosts() {
            const container = document.getElementById('posts-container');
            const blogger = config.blogger;
            const visitor = config.visitor;

            config.posts.forEach(post => {
                const postEl = document.createElement('article');
                postEl.className = 'post-card';
                postEl.id = `post-${post.id}`;

                let commentsHtml = '';
                post.comments.forEach(comment => {
                    const isVisitor = comment.username === visitor.name;
                    commentsHtml += `
                        <div class="comment-item">
                            <div class="comment-avatar">${createAvatarElement(comment.avatar, comment.username, 36)}</div>
                            <div class="comment-body">
                                <div class="comment-username ${isVisitor ? 'is-visitor' : ''}">${comment.username}</div>
                                <div class="comment-text">${comment.content}</div>
                                <div class="comment-meta">
                                    <span>${comment.time}</span>
                                    <button class="like-btn">‚ù§ ${comment.likes}</button>
                                </div>
                            </div>
                        </div>
                    `;
                });

                let imagesHtml = '';
                if (post.images && post.images.length > 0) {
                    imagesHtml = `
                        <div class="post-images">
                            <img src="${post.images[0]}" alt="Post image" onerror="this.outerHTML='<div class=\\'placeholder\\'>[ Image placeholder ]</div>'">
                        </div>
                    `;
                }

                postEl.innerHTML = `
                    <div class="post-header">
                        <div class="avatar">${createAvatarElement(blogger.avatar, blogger.displayName)}</div>
                        <div class="info">
                            <div class="name">
                                ${blogger.displayName}
                                ${blogger.verified ? '<span class="verified-badge">‚úì</span>' : ''}
                            </div>
                            <div class="meta">${post.publishDate} ${post.publishTime}</div>
                        </div>
                    </div>
                    <div class="post-content">
                        <h2 class="post-title">${post.title}</h2>
                        <div class="post-text">${post.content}</div>
                        ${imagesHtml}
                    </div>
                    <div class="post-stats">
                        <span>üëÅ ${formatNumber(post.views)} views</span>
                        <span>‚ù§ ${formatNumber(post.likes)} likes</span>
                        <span>üí¨ ${post.comments.length} comments</span>
                    </div>
                    <div class="post-actions">
                        <button class="${post.liked ? 'liked' : ''}" onclick="toggleLike(${post.id}, this)">
                            ${post.liked ? '‚ù§' : 'ü§ç'} Like
                        </button>
                        <button onclick="toggleComments(${post.id})">
                            üí¨ Comments
                        </button>
                        <button>
                            üîó Share
                        </button>
                    </div>
                    <div class="comments-section" id="comments-${post.id}" style="display: none;">
                        <div class="comments-header">Comments (${post.comments.length})</div>
                        ${commentsHtml}
                    </div>
                `;

                container.appendChild(postEl);
            });
        }

        // ========== Interactions ==========
        function toggleLike(postId, btn) {
            const post = config.posts.find(p => p.id === postId);
            if (post) {
                post.liked = !post.liked;
                if (post.liked) {
                    post.likes++;
                    btn.classList.add('liked');
                    btn.innerHTML = '‚ù§ Like';
                } else {
                    post.likes--;
                    btn.classList.remove('liked');
                    btn.innerHTML = 'ü§ç Like';
                }
                const statsEl = btn.closest('.post-card').querySelector('.post-stats span:nth-child(2)');
                statsEl.textContent = '‚ù§ ' + formatNumber(post.likes) + ' likes';
            }
        }

        function toggleComments(postId) {
            const commentsEl = document.getElementById(`comments-${postId}`);
            commentsEl.style.display = commentsEl.style.display === 'none' ? 'block' : 'none';
        }

        // ========== Chat / DM ==========
        function openChat() {
            document.getElementById('chat-overlay').classList.add('active');
            scrollChatToBottom();
            document.getElementById('chat-input').focus();
        }

        function closeChat() {
            document.getElementById('chat-overlay').classList.remove('active');
        }

        function initChatHistory() {
            config.chat.history.forEach(msg => {
                addMessageToChat(msg.content, msg.sender === 'visitor', msg.time);
            });
        }

        function addMessageToChat(content, isSent, time = null) {
            const messagesContainer = document.getElementById('chat-messages');
            const typingIndicator = document.getElementById('typing-indicator');

            const msgEl = document.createElement('div');
            msgEl.className = `message ${isSent ? 'sent' : 'received'}`;
            msgEl.innerHTML = `
                ${content}
                ${time ? `<span class="time">${time}</span>` : ''}
            `;

            messagesContainer.insertBefore(msgEl, typingIndicator);
            scrollChatToBottom();
        }

        function scrollChatToBottom() {
            const messagesContainer = document.getElementById('chat-messages');
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function getCurrentTime() {
            const now = new Date();
            const months = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
            const hours = now.getHours().toString().padStart(2, '0');
            const minutes = now.getMinutes().toString().padStart(2, '0');
            return `${now.getDate()} ${months[now.getMonth()]} ${hours}:${minutes}`;
        }

        function sendMessage() {
            const input = document.getElementById('chat-input');
            const content = input.value.trim();

            if (!content) return;

            addMessageToChat(content, true, getCurrentTime());
            input.value = '';

            if (replyCount < config.chat.maxReplies) {
                const typingIndicator = document.getElementById('typing-indicator');
                typingIndicator.classList.add('active');
                scrollChatToBottom();

                const autoReply = config.chat.autoReplies[replyCount];
                setTimeout(() => {
                    typingIndicator.classList.remove('active');
                    addMessageToChat(autoReply.reply, false, getCurrentTime());
                    replyCount++;

                    if (replyCount >= config.chat.maxReplies) {
                        setTimeout(() => {
                            const noReplyNotice = document.getElementById('no-reply-notice');
                            noReplyNotice.textContent = config.chat.noMoreReplyMessage;
                            noReplyNotice.classList.add('active');
                            scrollChatToBottom();
                        }, 2000);
                    }
                }, autoReply.delay);
            }
        }

        function handleChatKeypress(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }

        // Close on overlay click
        document.getElementById('chat-overlay').addEventListener('click', function(e) {
            if (e.target === this) {
                closeChat();
            }
        });

        // Init
        document.addEventListener('DOMContentLoaded', initPage);
    </script>
</body>
</html>
