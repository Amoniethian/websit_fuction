<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç§äººæ¡£æ¡ˆåº“</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- é¡¶éƒ¨å¯¼èˆª -->
    <nav class="navbar">
        <div class="logo">
            <span class="logo-icon">ğŸ“š</span>
            <div>
                <div class="logo-text" id="site-name"></div>
                <div class="logo-subtitle" id="site-subtitle"></div>
            </div>
        </div>
        <div class="nav-actions">
            <span class="last-updated">æœ€åæ›´æ–°: <span id="last-updated"></span></span>
            <div class="login-status" id="login-status">
                <span class="status-indicator" id="status-indicator"></span>
                <span class="status-text" id="status-text">æœªç™»å½•</span>
            </div>
            <button class="btn-login" id="btn-login" onclick="openLogin()">ç™»å½•</button>
            <button class="btn-logout" id="btn-logout" onclick="logout()" style="display: none;">ç™»å‡º</button>
        </div>
    </nav>

    <!-- ä¸»å¸ƒå±€ -->
    <div class="main-container">
        <!-- ä¾§è¾¹æ  -->
        <aside class="sidebar">
            <div class="sidebar-section">
                <div class="sidebar-title">å…¬å¼€æ¡£æ¡ˆ</div>
                <ul class="sidebar-nav" id="public-nav">
                    <!-- ç”± JS åŠ¨æ€ç”Ÿæˆ -->
                </ul>
            </div>
            <div class="sidebar-section" id="restricted-section">
                <div class="sidebar-title">å—é™æ¡£æ¡ˆ</div>
                <ul class="sidebar-nav" id="restricted-nav">
                    <!-- ç”± JS åŠ¨æ€ç”Ÿæˆ -->
                </ul>
            </div>
        </aside>

        <!-- å†…å®¹åŒº -->
        <main class="content-area" id="content-area">
            <!-- æ¬¢è¿é¡µé¢ -->
            <div class="welcome-page" id="welcome-page">
                <div class="icon">ğŸ”</div>
                <h2 id="welcome-title"></h2>
                <p id="welcome-description"></p>
            </div>

            <!-- æ–‡ç« å†…å®¹ï¼ˆéšè—ï¼‰ -->
            <div id="article-view" style="display: none;">
                <div class="content-header">
                    <div class="breadcrumb">
                        <a href="#" onclick="showWelcome(); return false;">é¦–é¡µ</a> / <span id="breadcrumb-category"></span>
                    </div>
                    <h1 id="article-title"></h1>
                    <div class="meta">
                        <span class="category-tag" id="article-category"></span>
                        <span>æœ€åä¿®æ”¹: <span id="article-modified"></span></span>
                    </div>
                </div>
                <div class="article-content" id="article-content">
                    <!-- æ–‡ç« å†…å®¹ -->
                </div>
            </div>
        </main>
    </div>

    <!-- ç™»å½•æ¨¡æ€æ¡† -->
    <div class="login-overlay" id="login-overlay">
        <div class="login-modal">
            <h2 id="login-title"></h2>
            <p class="subtitle" id="login-subtitle"></p>
            <form onsubmit="handleLogin(event)">
                <div class="form-group">
                    <label for="username">ç”¨æˆ·å</label>
                    <input type="text" id="username" placeholder="è¾“å…¥ç”¨æˆ·å" autocomplete="off">
                </div>
                <div class="form-group">
                    <label for="password">å¯†ç </label>
                    <input type="password" id="password" placeholder="è¾“å…¥å¯†ç ">
                </div>
                <div class="login-error" id="login-error"></div>
                <div class="login-actions">
                    <button type="button" class="btn-cancel" onclick="closeLogin()">å–æ¶ˆ</button>
                    <button type="submit" class="btn-submit">éªŒè¯èº«ä»½</button>
                </div>
            </form>
        </div>
    </div>

    <script src="config.js"></script>
    <script>
        // ========== å…¨å±€çŠ¶æ€ ==========
        let isLoggedIn = false;
        let currentArticle = null;
        const config = WIKI_CONFIG;

        // ========== åˆå§‹åŒ– ==========
        function initPage() {
            // è®¾ç½®ç½‘ç«™ä¿¡æ¯
            document.getElementById('site-name').textContent = config.siteName;
            document.getElementById('site-subtitle').textContent = config.siteSubtitle;
            document.getElementById('last-updated').textContent = config.lastUpdated;

            // è®¾ç½®æ¬¢è¿é¡µ
            document.getElementById('welcome-title').textContent = config.siteName;
            document.getElementById('welcome-description').textContent = config.siteDescription;

            // è®¾ç½®ç™»å½•æ¡†
            document.getElementById('login-title').textContent = config.ui.loginTitle;
            document.getElementById('login-subtitle').textContent = config.ui.loginSubtitle;
            document.getElementById('login-error').textContent = config.ui.loginError;

            // è®¾ç½®é¡µé¢æ ‡é¢˜
            document.title = config.siteName;

            // æ¸²æŸ“å¯¼èˆª
            renderNavigation();

            // æ£€æŸ¥æ˜¯å¦æœ‰ä¿å­˜çš„ç™»å½•çŠ¶æ€
            checkSavedLogin();
        }

        // ========== æ¸²æŸ“å¯¼èˆª ==========
        function renderNavigation() {
            const publicNav = document.getElementById('public-nav');
            const restrictedNav = document.getElementById('restricted-nav');

            // æ¸²æŸ“å…¬å¼€æ¡ç›®
            config.publicEntries.forEach(entry => {
                const li = document.createElement('li');
                const categoryIcon = getCategoryIcon(entry.category);
                li.innerHTML = `
                    <a href="#" onclick="loadArticle('${entry.id}', false); return false;">
                        <span class="icon">${categoryIcon}</span>
                        ${entry.title}
                    </a>
                `;
                publicNav.appendChild(li);
            });

            // æ¸²æŸ“å—é™æ¡ç›®
            config.restrictedEntries.forEach(entry => {
                const li = document.createElement('li');
                li.id = `nav-${entry.id}`;
                updateRestrictedNavItem(li, entry);
                restrictedNav.appendChild(li);
            });
        }

        function updateRestrictedNavItem(li, entry) {
            const categoryIcon = getCategoryIcon(entry.category);
            if (isLoggedIn) {
                li.innerHTML = `
                    <a href="#" onclick="loadArticle('${entry.id}', true); return false;">
                        <span class="icon">${categoryIcon}</span>
                        ${entry.title}
                        ${entry.classification === 'é«˜åº¦æœºå¯†' ? '<span class="badge">æœºå¯†</span>' : ''}
                    </a>
                `;
            } else {
                li.innerHTML = `
                    <a href="#" class="locked" onclick="openLogin(); return false;">
                        <span class="icon">${categoryIcon}</span>
                        ${entry.title}
                        <span class="lock-icon">ğŸ”’</span>
                    </a>
                `;
            }
        }

        function getCategoryIcon(category) {
            const cat = config.categories.find(c => c.name === category);
            return cat ? cat.icon : 'ğŸ“„';
        }

        // ========== æ–‡ç« åŠ è½½ ==========
        function loadArticle(id, isRestricted) {
            if (isRestricted && !isLoggedIn) {
                openLogin();
                return;
            }

            const entries = isRestricted ? config.restrictedEntries : config.publicEntries;
            const entry = entries.find(e => e.id === id);

            if (!entry) return;

            currentArticle = entry;

            // æ›´æ–°å¯¼èˆªé«˜äº®
            document.querySelectorAll('.sidebar-nav a').forEach(a => a.classList.remove('active'));
            const navItem = document.querySelector(`#nav-${id} a`) ||
                           document.querySelector(`.sidebar-nav a[onclick*="${id}"]`);
            if (navItem) navItem.classList.add('active');

            // æ˜¾ç¤ºæ–‡ç« 
            document.getElementById('welcome-page').style.display = 'none';
            document.getElementById('article-view').style.display = 'block';

            document.getElementById('breadcrumb-category').textContent = entry.category;
            document.getElementById('article-title').textContent = entry.title;
            document.getElementById('article-category').textContent = entry.category;
            document.getElementById('article-modified').textContent = entry.lastModified;
            document.getElementById('article-content').innerHTML = entry.content;
        }

        function showWelcome() {
            document.getElementById('welcome-page').style.display = 'block';
            document.getElementById('article-view').style.display = 'none';
            document.querySelectorAll('.sidebar-nav a').forEach(a => a.classList.remove('active'));
            currentArticle = null;
        }

        // ========== ç™»å½•åŠŸèƒ½ ==========
        function openLogin() {
            document.getElementById('login-overlay').classList.add('active');
            document.getElementById('username').focus();
            document.getElementById('login-error').classList.remove('active');
        }

        function closeLogin() {
            document.getElementById('login-overlay').classList.remove('active');
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
        }

        function handleLogin(event) {
            event.preventDefault();

            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value;

            if (username === config.credentials.username && password === config.credentials.password) {
                // ç™»å½•æˆåŠŸ
                isLoggedIn = true;
                sessionStorage.setItem('wiki_logged_in', 'true');
                closeLogin();
                updateLoginStatus();
                updateRestrictedNav();

                // å¦‚æœå½“å‰æ­£åœ¨å°è¯•è®¿é—®æŸä¸ªå—é™æ–‡ç« ï¼Œé‡æ–°åŠ è½½å®ƒ
                if (currentArticle && config.restrictedEntries.find(e => e.id === currentArticle.id)) {
                    loadArticle(currentArticle.id, true);
                }
            } else {
                // ç™»å½•å¤±è´¥
                document.getElementById('login-error').classList.add('active');
                document.getElementById('password').value = '';
                document.getElementById('password').focus();
            }
        }

        function logout() {
            isLoggedIn = false;
            sessionStorage.removeItem('wiki_logged_in');
            updateLoginStatus();
            updateRestrictedNav();
            showWelcome();
        }

        function updateLoginStatus() {
            const indicator = document.getElementById('status-indicator');
            const statusText = document.getElementById('status-text');
            const btnLogin = document.getElementById('btn-login');
            const btnLogout = document.getElementById('btn-logout');

            if (isLoggedIn) {
                indicator.classList.add('logged-in');
                statusText.textContent = config.ui.loggedInMessage;
                btnLogin.style.display = 'none';
                btnLogout.style.display = 'block';
            } else {
                indicator.classList.remove('logged-in');
                statusText.textContent = 'æœªç™»å½•';
                btnLogin.style.display = 'block';
                btnLogout.style.display = 'none';
            }
        }

        function updateRestrictedNav() {
            config.restrictedEntries.forEach(entry => {
                const li = document.getElementById(`nav-${entry.id}`);
                if (li) {
                    updateRestrictedNavItem(li, entry);
                }
            });
        }

        function checkSavedLogin() {
            if (sessionStorage.getItem('wiki_logged_in') === 'true') {
                isLoggedIn = true;
                updateLoginStatus();
                updateRestrictedNav();
            }
        }

        // ç‚¹å‡»é®ç½©å±‚å…³é—­
        document.getElementById('login-overlay').addEventListener('click', function(e) {
            if (e.target === this) {
                closeLogin();
            }
        });

        // ESC é”®å…³é—­
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeLogin();
            }
        });

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', initPage);
    </script>
</body>
</html>
